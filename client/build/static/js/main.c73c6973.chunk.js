(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{64:function(t,e,a){t.exports=a(81)},71:function(t,e,a){},73:function(t,e,a){},81:function(t,e,a){"use strict";a.r(e);var n=a(0),o=a.n(n),r=a(13),i=a.n(r),s=(a(69),a(70),a(71),a(27)),c=a.n(s),l=a(52),u=a(35),h=a(36),p=a(48),m=a(37),d=a(49),f=a(90),g=a(93),v=a(85),k=a(92),y=a(91),w=a(84),E=a(88),b=a(89),S=a(87),x=a(86),C=a(57),j=a(8),N=a.n(j),z=(a(73),o.a.Component,function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(p.a)(this,Object(m.a)(e).call(this,t))).callBackendAPI=Object(l.a)(c.a.mark((function t(){var e,a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://localhost:5000/api");case 2:return e=t.sent,t.next=5,e.json();case 5:if(a=t.sent,console.log(a.express),200===e.status){t.next=9;break}throw Error(a.message);case 9:return t.abrupt("return",a);case 10:case"end":return t.stop()}}),t)}))),a.state={location:{lat:-41.2728,lng:173.2995},zoom:8,index:null,markersData:[],fault:[],photos:[],currentPhoto:null,currentFault:null,layers:[],bounds:{},icon:a.getCustomIcon(),show:!1,modalPhoto:null,popover:!1,photourl:null,amazon:"https:/taranaki.s3.ap-southeast-2.amazonaws.com/Roads/2019_11/"},a}return Object(d.a)(e,t),Object(h.a)(e,[{key:"getCustomIcon",value:function(t,e){var a=this.getSize(e);return"Scabbing"===t?N.a.icon({iconUrl:"CameraSpringGreen_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]}):"Flushing"===t?N.a.icon({iconUrl:"CameraDodgerBlue_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]}):N.a.icon({iconUrl:"CameraRed_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]})}},{key:"getSize",value:function(t){return t<10?4:t>=10&&t<=16?8:16}},{key:"componentDidMount",value:function(){this.callBackendAPI().catch((function(t){return console.log(t)}))}},{key:"componentDidUpdate",value:function(){}},{key:"addMarkers",value:function(){var t=Object(l.a)(c.a.mark((function t(e){var a,n,o,r,i,s,l,u,h,p;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(a=[],n=[],o=[],r=0;r<e.length;r++)e[r].gid,i=e[r].fault,s=e[r].photoid,n.push(i),o.push(s),l=JSON.parse(e[r].st_asgeojson),u=l.coordinates[0],h=l.coordinates[1],p=N.a.latLng(h,u),a.push(p);this.setState({markersData:a}),this.setState({fault:n}),this.setState({photos:o});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onZoom",value:function(t){this.setState({zoom:t.target.getZoom()}),this.setState({bounds:t.target.getBounds()})}},{key:"clickImage",value:function(t){this.setState({show:!0})}},{key:"pad",value:function(t,e,a){return a=a||"0",(t+="").length>=e?t:new Array(e-t.length+1).join(a)+t}},{key:"clickPrev",value:function(t){var e=this.state.currentPhoto,a=(e.slice(e.length-5,e.length),parseInt(e.slice(e.length-5,e.length))-1),n=this.pad(a,5),o=e.slice(0,e.length-5)+n;this.setState({currentPhoto:o});var r=this.state.amazon+o+".jpg";this.setState({photourl:r})}},{key:"clickNext",value:function(t){var e=this.state.currentPhoto,a=(e.slice(e.length-5,e.length),parseInt(e.slice(e.length-5,e.length))+1),n=this.pad(a,5),o=e.slice(0,e.length-5)+n;this.setState({currentPhoto:o});var r=this.state.amazon+o+".jpg";this.setState({photourl:r})}},{key:"clickMarker",value:function(t){var e=t.target,a=e.options.index;this.setState({index:a});e.options.data;var n=this.state.photos[a],o=this.state.amazon+n+".jpg";this.setState({photourl:o}),this.setState({currentFault:this.state.fault[a]}),this.setState({popover:!0}),this.setState({currentPhoto:this.state.photos[a]}),this.renderModal(this.state.photos[a])}},{key:"loadLayer",value:function(){var t=Object(l.a)(c.a.mark((function t(e){var a,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://localhost:5000/layer",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({latitude:this.state.location.lat,longitude:this.state.location.lng,menu:e.target.id})});case 2:if(200===(a=t.sent).status){t.next=5;break}throw Error(n.message);case 5:return t.next=7,a.json();case 7:return n=t.sent,t.next=10,this.addMarkers(n);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"closeModal",value:function(){this.setState({show:!1}),this.setState({popover:!1})}},{key:"renderModal",value:function(t){}},{key:"render",value:function(){var t=this,e=[this.state.location.lat,this.state.location.lng],a=this.state.markersData.markersData,n=this.state.fault.fault,r=this.state.photos.photo;o.a.createElement(y.a,null,o.a.createElement("div",null,o.a.createElement("div",null,this.state.currentFault),o.a.createElement("div",null,o.a.createElement(w.a,{className:"thumbnail",src:"CameraSpringGreen_16px.png",photo:r,onClick:function(e){return t.clickImage(e)},thumbnail:!0,width:"128",height:"128"}))));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement(E.a,{bg:"light",expand:"lg"},o.a.createElement(E.a.Brand,{href:"#home"}),o.a.createElement(b.a,null,o.a.createElement(S.a,{title:"Layers",id:"basic-nav-dropdown"},o.a.createElement(S.a.Item,{id:"AddLayer",href:"#addlayer",onClick:function(e){return t.loadLayer(e)}},"Add Layer"),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{href:"#action/3.4"},"Separated link"))),o.a.createElement(b.a,{className:"ml-auto"},o.a.createElement(b.a.Link,{href:"#login"},"Login")))),o.a.createElement("div",{className:"map"},o.a.createElement(f.a,{ref:function(e){t.map=e},className:"map",markersData:a,fault:n,photo:r,worldCopyJump:!0,center:e,zoom:this.state.zoom,onZoom:function(e){return t.onZoom(e)}},o.a.createElement(g.a,{attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors and Chat location by Iconika from the Noun Project',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),this.state.markersData.map((function(e,a){return o.a.createElement(v.a,{key:"".concat(a),index:a,data:n,photo:r,position:e,icon:t.getCustomIcon(t.state.fault[a],t.state.zoom),draggable:!1,onClick:function(e){return t.clickMarker(e)}},o.a.createElement(k.a,{className:"popup"},o.a.createElement("div",null,o.a.createElement("p",null,t.state.currentFault),o.a.createElement("div",null,o.a.createElement(w.a,{className:"thumbnail",src:t.state.photourl,photo:r,onClick:function(e){return t.clickImage(e)},thumbnail:!0})))))})))),o.a.createElement(x.a,{show:this.state.show,size:"xl"},o.a.createElement(x.a.Header,null,o.a.createElement(x.a.Title,null,this.state.currentFault)),o.a.createElement(x.a.Body,null,o.a.createElement(w.a,{className:"photo",src:this.state.photourl,data:n,onClick:function(e){return t.clickImage(e)},thumbnail:!0})),o.a.createElement(x.a.Footer,null,o.a.createElement(C.a,{className:"prev",onClick:function(e){return t.clickPrev(e)}},"Previous"),o.a.createElement(C.a,{variant:"primary",onClick:function(){return t.setState({show:!1})}},"Close"),o.a.createElement(C.a,{className:"next",variant:"primary",onClick:function(e){return t.clickNext(e)}},"Next"))),o.a.createElement("div",{className:"footer"}))}}]),e}(n.Component)),P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function I(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var a=t.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}i.a.render(o.a.createElement(z,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");P?(!function(t,e){fetch(t).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):I(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):I(e,t)}))}}()}},[[64,1,2]]]);
//# sourceMappingURL=main.c73c6973.chunk.js.map